Version 4
SHEET 1 3712 1104
WIRE -576 -288 -608 -288
WIRE -688 -256 -752 -256
WIRE -608 -256 -608 -288
WIRE -608 -256 -688 -256
WIRE -752 -240 -752 -256
WIRE -688 -176 -752 -176
WIRE -608 -176 -688 -176
WIRE -608 -160 -608 -176
WIRE 176 -112 112 -112
WIRE -1264 -96 -1264 -112
WIRE -880 -96 -880 -112
WIRE 112 -80 112 -112
WIRE -208 -48 -1264 -48
WIRE -1264 -32 -1264 -48
WIRE -1264 80 -1264 48
WIRE -928 112 -1280 112
WIRE -1280 128 -1280 112
WIRE -928 176 -928 112
WIRE -912 176 -928 176
WIRE -720 176 -768 176
WIRE -608 176 -640 176
WIRE -528 176 -608 176
WIRE -480 176 -528 176
WIRE -240 176 -400 176
WIRE -192 176 -240 176
WIRE 336 176 304 176
WIRE 64 192 16 192
WIRE -912 208 -928 208
WIRE -720 208 -768 208
WIRE -608 208 -608 176
WIRE 528 208 304 208
WIRE 688 208 608 208
WIRE 768 208 688 208
WIRE 1088 208 992 208
WIRE -240 224 -240 176
WIRE -128 224 -240 224
WIRE -240 240 -240 224
WIRE -1280 272 -1280 208
WIRE -928 272 -928 208
WIRE -928 272 -1280 272
WIRE 528 304 464 304
WIRE 688 304 608 304
WIRE 768 304 688 304
WIRE 1088 304 992 304
WIRE 336 320 304 320
WIRE 64 336 16 336
WIRE 464 352 464 304
WIRE 464 352 304 352
WIRE -240 368 -240 320
WIRE -128 368 -128 224
WIRE 528 400 464 400
WIRE 688 400 608 400
WIRE 768 400 688 400
WIRE 1088 400 992 400
WIRE 336 464 304 464
WIRE 64 480 16 480
WIRE 464 496 464 400
WIRE 464 496 304 496
WIRE 768 496 656 496
WIRE 1088 496 992 496
WIRE -1120 512 -1120 496
WIRE -1264 528 -1264 496
WIRE 656 528 656 496
WIRE 768 528 656 528
WIRE 1088 528 992 528
WIRE 656 544 656 528
WIRE 768 560 704 560
WIRE -720 576 -720 208
WIRE -608 576 -608 288
WIRE -608 576 -720 576
WIRE -608 592 -608 576
WIRE -320 592 -384 592
WIRE 704 592 704 560
WIRE 704 592 -320 592
WIRE -1264 640 -1264 608
WIRE -384 640 -384 592
WIRE -576 656 -608 656
WIRE -608 688 -608 656
WIRE -736 704 -768 704
WIRE -768 736 -768 704
WIRE -864 752 -896 752
WIRE -896 784 -896 752
FLAG -608 592 0
FLAG -1264 80 0
FLAG -384 720 0
FLAG -896 864 0
FLAG -864 752 t_pwl
FLAG -768 816 0
FLAG -736 704 t_pulse
FLAG -608 -160 0
FLAG -576 -288 t_stop
FLAG -1264 -96 0
FLAG -1264 -192 trgt_sin
FLAG -880 -96 0
FLAG -880 -192 trgt_pwl
FLAG -608 768 0
FLAG -576 656 t_pulsefact
FLAG 656 544 0
FLAG -320 592 t_in
FLAG 1088 496 angle
IOPIN 1088 496 Out
FLAG 1088 208 h1
IOPIN 1088 208 Out
FLAG 1088 304 h2
IOPIN 1088 304 Out
FLAG 16 192 a
IOPIN 16 192 In
FLAG 16 336 b
IOPIN 16 336 In
FLAG 16 480 c
IOPIN 16 480 In
FLAG -528 176 p_28v_1
FLAG 176 -112 clk
IOPIN 176 -112 Out
FLAG 112 0 0
FLAG -1264 416 vbus_ss
FLAG -1120 416 vbus_pwl
FLAG -1264 720 0
FLAG -1120 512 0
FLAG 1088 400 h3
IOPIN 1088 400 Out
FLAG 1088 528 w
IOPIN 1088 528 Out
FLAG 336 176 i_sns_a
IOPIN 336 176 Out
FLAG 336 320 i_sns_b
IOPIN 336 320 Out
FLAG 336 464 i_sns_c
IOPIN 336 464 Out
FLAG -192 176 p_28v
IOPIN -192 176 Out
FLAG -208 -48 target
IOPIN -208 -48 Out
FLAG 688 208 phase_a
FLAG 688 304 phase_b
FLAG 688 400 phase_c
FLAG -240 432 0
FLAG -128 432 0
SYMBOL voltage -496 176 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 -32 56 VBottom 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V2
SYMATTR Value 0
SYMBOL bi -608 208 R0
SYMATTR InstName B1
SYMATTR Value I=3*I(V2)+13.1/0.85/28
SYMBOL bv -384 624 R0
SYMATTR InstName B2
SYMATTR Value V=V(t_stop)+V(t_pwl)+V(t_pulsefact)*V(t_pulse)
SYMBOL voltage -896 768 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V5
SYMATTR Value 0 dc 0 PWL(0 0 50m 0 50.001m 400m 80m 400m 80.001m 0 110m 0 110.001m -400m 140m -400m 140.001m 0 200m 0 200.001m 150m 300m 150m 500m 400m 500.001m 0)
SYMBOL voltage -768 720 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V6
SYMATTR Value 0 dc 0 PULSE(400m -400m 0 1u 1u 27.1m 54.2m)
SYMBOL bi -608 -176 M180
WINDOW 0 24 80 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName B3
SYMATTR Value I={stop_gain}*(min(max(0,V(angle)-{deg_range}*180/pi*{gear_rat}),100k)+min(max(-100k,V(angle)+{deg_range}*180/pi*{gear_rat}),0))
SYMBOL res -704 -272 R0
SYMATTR InstName R7
SYMATTR Value 1
SYMBOL voltage -608 672 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V3
SYMATTR Value 0 dc 0 PWL(0 0 500m 0 700m 1)
SYMBOL cap -768 -240 R0
SYMATTR InstName C3
SYMATTR Value 1n
SYMBOL voltage -736 176 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 -32 56 VBottom 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V_Itot
SYMATTR Value 0
SYMBOL voltage 512 208 R270
WINDOW 0 16 5 VTop 2
WINDOW 3 -32 56 VBottom 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V_A
SYMATTR Value 0
SYMBOL voltage 512 304 R270
WINDOW 0 19 10 VTop 2
WINDOW 3 -32 56 VBottom 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V_B
SYMATTR Value 0
SYMBOL voltage 512 400 R270
WINDOW 0 16 6 VTop 2
WINDOW 3 -32 56 VBottom 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V_C
SYMATTR Value 0
SYMBOL voltage -1264 400 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V1
SYMATTR Value 28
SYMBOL voltage -1264 512 R0
SYMATTR InstName V4
SYMATTR Value dc 0 SINE(0 6 13)
SYMBOL voltage -1264 624 R0
SYMATTR InstName V7
SYMATTR Value dc 0 SINE(0 0 20k)
SYMBOL voltage -1120 400 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V8
SYMATTR Value dc 0 PWL(0 1 1m 1)
SYMBOL voltage -1264 -208 R0
SYMATTR InstName V9
SYMATTR Value dc 0 SINE(0 1 10)
SYMBOL voltage -880 -208 R0
SYMATTR InstName V10
SYMATTR Value dc 0 PWL(0 0 100m 0 150m 0 300m 0)
SYMBOL bv -1264 -48 R0
SYMATTR InstName B4
SYMATTR Value V=2.5+2.5/{deg_range}*(V(trgt_pwl)+V(trgt_sin))
SYMBOL bv -1280 112 R0
SYMATTR InstName B6
SYMATTR Value V=V(Vbus_ss)*V(Vbus_pwl)
SYMBOL voltage 112 -96 R0
SYMATTR InstName V11
SYMATTR Value dc 0 PULSE(0 1 0 0 0 16u 32u)
SYMBOL BLDC_SCD00914 880 480 R0
SYMATTR InstName X4
SYMBOL USA13030_X1_NG_cont_out_fltr 176 192 R0
SYMATTR InstName X1
SYMBOL USA13030_X1_NG_cont_out_fltr 176 336 R0
SYMATTR InstName X2
SYMBOL USA13030_X1_NG_cont_out_fltr 176 480 R0
SYMATTR InstName X3
SYMBOL USA13030_X1_NG_cont_in_fltr -848 192 R0
SYMATTR InstName X5
SYMBOL res -256 224 R0
SYMATTR InstName R1
SYMATTR Value 720µ
SYMBOL cap -256 368 R0
SYMATTR InstName C1
SYMATTR Value 17µ
SYMBOL cap -144 368 R0
SYMATTR InstName C2
SYMATTR Value 100n
TEXT 672 104 Left 2 ;H1, H2, H3 mapped to A,B,C \ndifferently than 914 motor config
TEXT -1248 768 Left 2 ;Option to inject\nCS101 worst case\nfrequency here.
TEXT -1200 568 Left 2 ;Slow variation in bus
TEXT -1296 -296 Left 2 ;Enter amplitudes in degrees of tail movement
TEXT -1160 -64 Left 2 ;Target angle signal must be band-limited (done in MCU).
TEXT -592 320 Left 2 ;If there are convergence\nproblems in NGspice, then\np_28V can be replaced by\njust a constant 28V. \n13.1 W max from Bias.\n85% switcher efficiency\nassumed.\n3X current added to simulate\nthe quad driver.
TEXT 328 -120 Left 2 ;clk needed for NGspice \nmixed-signal simulation. \nIt has no significant penalty \non LTspice simulation speed.
TEXT -760 -408 Left 4 ;USA13030-X1 NGspice-Compatible Continuous (smoothed PWM) Subcircuit
TEXT -568 -232 Left 2 ;Position-dependent (very high) torque to simulate mechanical stops.
TEXT -832 -368 Left 2 ;Note that LTspice can emulate an MCU or FPGA only very crudely, so this subcircuit netlist is intended to be used with PySPICE, which will emulate \nthe MCU properly in Python. In addition to being a netlist generator for PySPICE, this LTspice version is useful for initial debug of the subcircuit.
TEXT -256 472 Left 2 ;Distributed portion\nof input filter caps.
