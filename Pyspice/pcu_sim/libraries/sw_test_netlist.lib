.subckt sw_test_netlist input_v_p input_v_m sw_node_hs hs_drive N023
XX1 input_v_p input_v_m sw_node_hs hs_drive N023
.ends sw_test_netlist



******************************************************************************************************************
* STEPS TO GET FROM LTSPICE NETLIST TO THIS NGSPICE NETLIST:
* Delete everything that's not a subcircuit (including end of file top-level statements such as .tran, .end);
* This file is only a collection of subcircuits, not a complete SPICE netlist.
* Add parameters to each subckt line (just copy from any instantiation of said subcircuit; do not include "params:")
* Change unicode 'mu' to 'u'
* Replace any dash in any subcircuit name with an underscore 
* Add top subcircuit ngspice_top using instantiation line for XX1 in original top-level netlist (see text before this note)
*	It is important to include the XX1 instantiation as above otherwise the models below do not get connected
******************************************************************************************************************

.subckt sw_test_netlist input_v_p input_v_m sw_node_hs hs_drive N023


V1 N043 0 100
R17 N043 sw_node_hs 0.0036

*R17 hs_drive 0 1
*S1 sw_node_hs 0 N040 0 myswitch

* M1 
M1 N001 sw_node_hs N023 0 irf150

*D1 sw_node_hs input_v_p 1N5819
* drive circuit with deadband
R18 hs_drive N023 10
R19 hs_drive 0 10
C5 N023 0 10n
*D2 N023 hs_drive 1N5819




*output load
R23 0 sw_node_hs 70
*L23 N026 0 70u


* driver comparing sin to tri references
* high side comparator
*V1 N100 0 10
*R24 N100 N101 10
*S3 N101 0 sin_ref tri_ref myswitch
* inverted for low side
*V2 N102 0 10
*R25 N102 N103 10
*S4 N103 0 tri_ref sin_ref myswitch

*B1 hs_drive 0 V=V(N101)
*B2 ls_drive 0 V=V(N103)


* had to hard code the duty cycle because cannot yet pass time values to/from python code
*V2 gate_drive 0 PULSE(0 10 0 1n 1n 1.25u 2.5u 200)

*.model 1N5819 D(Is=31.7u Rs=.051 N=1.373 Cjo=110p M=.35 Eg=.69 Xti=2 Iave=1 Vpk=400 type=Schottky)
.model myswitch SW(Ron=0.002 Roff=1Meg Vt=3.0)

.ends stator_drive_netlist


* -*- spice -*-
* http://www.irf.com/product-info/models/spice/irf150.spi
*
.SUBCKT irf150 1 2 3
**************************************
*      Model Generated by MODPEX     *
*Copyright(c) Symmetry Design Systems*
*         All Rights Reserved        *
*    UNPUBLISHED LICENSED SOFTWARE   *
*   Contains Proprietary Information *
*      Which is The Property of      *
*     SYMMETRY OR ITS LICENSORS      *
*Commercial Use or Resale Restricted *
*   by Symmetry License Agreement    *
**************************************
* Model generated on Dec 17, 96
* MODEL FORMAT: SPICE3
* Symmetry POWER MOS Model (Version 1.0)
* External Node Designations
* Node 1 -> Drain
* Node 2 -> Gate
* Node 3 -> Source
M1 9 7 8 8 MM L=100u W=100u
* Default values used in MM:
* The voltage-dependent capacitances are
* not included. Other default values are:
*   RS=0 RD=0 LD=0 CBD=0 CBS=0 CGBO=0
.MODEL MM NMOS LEVEL=1 IS=1e-32
+VTO=4.07861 LAMBDA=0.000761669 KP=19.0218
+CGSO=3.57784e-05 CGDO=4.96221e-07
RS 8 3 0.0216597
D1 3 1 MD
.MODEL MD D IS=2.01865e-09 RS=0.11592 N=1.5 BV=100
+IBV=0.001 EG=1 XTI=1 TT=1e-07
+CJO=3.28974e-09 VJ=4.39387 M=0.659734 FC=0.1
RDS 3 1 3.2e+06
RD 9 1 0.00224103
RG 2 7 12.1
D2 4 5 MD1
* Default values used in MD1:
*   RS=0 EG=1.11 XTI=3.0 TT=0
*   BV=infinite IBV=1mA
.MODEL MD1 D IS=1e-32 N=50
+CJO=3.78329e-09 VJ=0.607074 M=0.893797 FC=1e-08
D3 0 5 MD2
* Default values used in MD2:
*   EG=1.11 XTI=3.0 TT=0 CJO=0
*   BV=infinite IBV=1mA
.MODEL MD2 D IS=1e-10 N=0.402271 RS=3.00001e-06
RL 5 10 1
FI2 7 9 VFI2 -1
VFI2 4 0 0
EV16 10 0 9 7 1
CAP 11 10 3.78329e-09
FI1 7 9 VFI1 -1
VFI1 11 6 0
RCAP 6 10 1
D4 0 6 MD3
* Default values used in MD3:
*   EG=1.11 XTI=3.0 TT=0 CJO=0
*   RS=0 BV=infinite IBV=1mA
.MODEL MD3 D IS=1e-10 N=0.402271
.ENDS irf150