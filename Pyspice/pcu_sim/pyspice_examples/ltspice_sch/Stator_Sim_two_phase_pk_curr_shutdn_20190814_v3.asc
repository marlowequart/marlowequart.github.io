Version 4
SHEET 1 7936 1952
WIRE -4224 -4240 -4416 -4240
WIRE -2880 -4176 -3024 -4176
WIRE -4496 -4128 -4496 -4160
WIRE -4432 -4128 -4496 -4128
WIRE -4496 -4096 -4544 -4096
WIRE -4432 -4096 -4432 -4128
WIRE -4432 -4096 -4448 -4096
WIRE -4416 -4080 -4416 -4240
WIRE -4352 -4080 -4416 -4080
WIRE -2304 -4080 -2496 -4080
WIRE -4224 -4064 -4224 -4240
WIRE -4224 -4064 -4288 -4064
WIRE -4176 -4064 -4224 -4064
WIRE -5152 -4048 -5216 -4048
WIRE -5008 -4048 -5072 -4048
WIRE -4832 -4048 -5008 -4048
WIRE -4736 -4048 -4832 -4048
WIRE -4512 -4048 -4736 -4048
WIRE -4400 -4048 -4432 -4048
WIRE -4352 -4048 -4400 -4048
WIRE -2928 -4048 -3152 -4048
WIRE -2880 -4048 -2880 -4176
WIRE -2496 -4048 -2496 -4080
WIRE -4400 -4032 -4400 -4048
WIRE -3152 -4032 -3152 -4048
WIRE -2928 -4032 -2928 -4048
WIRE -2304 -4032 -2304 -4080
WIRE -2304 -3984 -2352 -3984
WIRE -5216 -3968 -5216 -4048
WIRE -5008 -3968 -5008 -4048
WIRE -4832 -3968 -4832 -4048
WIRE -4832 -3952 -4832 -3968
WIRE -2496 -3952 -2496 -3968
WIRE -2352 -3952 -2352 -3984
WIRE -2352 -3952 -2496 -3952
WIRE -3152 -3936 -3152 -3952
WIRE -2928 -3936 -2928 -3984
WIRE -2928 -3936 -3152 -3936
WIRE -2496 -3936 -2496 -3952
WIRE -3152 -3920 -3152 -3936
WIRE -5632 -3888 -6032 -3888
WIRE -2880 -3856 -2880 -3968
WIRE -2576 -3856 -2880 -3856
WIRE -2432 -3856 -2576 -3856
WIRE -2256 -3856 -2256 -3968
WIRE -2256 -3856 -2432 -3856
WIRE -5216 -3808 -5216 -3888
WIRE -5008 -3808 -5008 -3904
WIRE -5008 -3808 -5216 -3808
WIRE -4832 -3808 -4832 -3888
WIRE -4832 -3808 -5008 -3808
WIRE -6032 -3792 -6032 -3888
WIRE -5632 -3792 -5632 -3888
WIRE -5216 -3776 -5216 -3808
WIRE -4224 -3728 -4416 -3728
WIRE -2944 -3664 -3088 -3664
WIRE -6032 -3616 -6032 -3712
WIRE -5632 -3616 -5632 -3712
WIRE -5632 -3616 -6032 -3616
WIRE -4496 -3616 -4496 -3648
WIRE -4432 -3616 -4496 -3616
WIRE -4496 -3584 -4544 -3584
WIRE -4432 -3584 -4432 -3616
WIRE -4432 -3584 -4448 -3584
WIRE -3088 -3584 -3088 -3664
WIRE -6032 -3568 -6032 -3616
WIRE -4416 -3568 -4416 -3728
WIRE -4352 -3568 -4416 -3568
WIRE -2368 -3568 -2560 -3568
WIRE -4224 -3552 -4224 -3728
WIRE -4224 -3552 -4288 -3552
WIRE -4176 -3552 -4224 -3552
WIRE -5152 -3536 -5216 -3536
WIRE -5008 -3536 -5072 -3536
WIRE -4832 -3536 -5008 -3536
WIRE -4512 -3536 -4832 -3536
WIRE -4400 -3536 -4432 -3536
WIRE -4352 -3536 -4400 -3536
WIRE -2992 -3536 -3216 -3536
WIRE -2944 -3536 -2944 -3664
WIRE -2560 -3536 -2560 -3568
WIRE -4400 -3520 -4400 -3536
WIRE -3216 -3520 -3216 -3536
WIRE -2992 -3520 -2992 -3536
WIRE -2368 -3520 -2368 -3568
WIRE -2368 -3472 -2416 -3472
WIRE -5216 -3456 -5216 -3536
WIRE -5008 -3456 -5008 -3536
WIRE -4832 -3456 -4832 -3536
WIRE -4832 -3440 -4832 -3456
WIRE -2560 -3440 -2560 -3456
WIRE -2416 -3440 -2416 -3472
WIRE -2416 -3440 -2560 -3440
WIRE -3216 -3424 -3216 -3440
WIRE -2992 -3424 -2992 -3472
WIRE -2992 -3424 -3216 -3424
WIRE -2560 -3424 -2560 -3440
WIRE -3216 -3408 -3216 -3424
WIRE -5920 -3344 -6080 -3344
WIRE -5760 -3344 -5840 -3344
WIRE -5616 -3344 -5760 -3344
WIRE -5552 -3344 -5616 -3344
WIRE -2944 -3344 -2944 -3456
WIRE -2640 -3344 -2944 -3344
WIRE -2496 -3344 -2640 -3344
WIRE -2320 -3344 -2320 -3456
WIRE -2320 -3344 -2496 -3344
WIRE -5760 -3328 -5760 -3344
WIRE -5216 -3296 -5216 -3376
WIRE -5008 -3296 -5008 -3392
WIRE -5008 -3296 -5216 -3296
WIRE -4832 -3296 -4832 -3376
WIRE -4832 -3296 -5008 -3296
WIRE -5760 -3264 -6080 -3264
WIRE -5552 -3264 -5760 -3264
WIRE -5216 -3264 -5216 -3296
WIRE -3152 -2864 -3536 -2864
WIRE -3536 -2784 -3536 -2864
WIRE -3152 -2784 -3152 -2864
WIRE -3152 -2768 -3152 -2784
WIRE -3536 -2624 -3536 -2704
WIRE -3152 -2624 -3152 -2704
WIRE -3152 -2624 -3536 -2624
WIRE -3536 -2592 -3536 -2624
WIRE -4432 -2480 -4816 -2480
WIRE -4416 -2480 -4432 -2480
WIRE -5040 -2464 -5440 -2464
WIRE -5824 -2448 -6224 -2448
WIRE -4816 -2384 -4816 -2480
WIRE -4416 -2384 -4416 -2480
WIRE -5440 -2368 -5440 -2464
WIRE -5040 -2368 -5040 -2464
WIRE -6224 -2352 -6224 -2448
WIRE -5824 -2352 -5824 -2448
WIRE -672 -2320 -1056 -2320
WIRE 112 -2304 -272 -2304
WIRE -1056 -2240 -1056 -2320
WIRE -672 -2240 -672 -2320
WIRE -672 -2224 -672 -2240
WIRE -272 -2224 -272 -2304
WIRE 112 -2224 112 -2304
WIRE -4816 -2208 -4816 -2304
WIRE -4416 -2208 -4416 -2304
WIRE -4416 -2208 -4816 -2208
WIRE 112 -2208 112 -2224
WIRE -5440 -2192 -5440 -2288
WIRE -5040 -2192 -5040 -2288
WIRE -5040 -2192 -5440 -2192
WIRE -6224 -2176 -6224 -2272
WIRE -5824 -2176 -5824 -2272
WIRE -5824 -2176 -6224 -2176
WIRE -4816 -2160 -4816 -2208
WIRE -5440 -2144 -5440 -2192
WIRE 4080 -2144 4064 -2144
WIRE 4160 -2144 4080 -2144
WIRE 4512 -2144 4160 -2144
WIRE 6304 -2144 5968 -2144
WIRE 6400 -2144 6304 -2144
WIRE 6416 -2144 6400 -2144
WIRE -6224 -2128 -6224 -2176
WIRE 2192 -2128 2048 -2128
WIRE 2304 -2128 2272 -2128
WIRE 2544 -2128 2384 -2128
WIRE 2896 -2128 2544 -2128
WIRE 4512 -2128 4512 -2144
WIRE 5968 -2128 5968 -2144
WIRE 2048 -2096 2048 -2128
WIRE -1056 -2080 -1056 -2160
WIRE -672 -2080 -672 -2160
WIRE -672 -2080 -1056 -2080
WIRE -272 -2064 -272 -2144
WIRE 112 -2064 112 -2144
WIRE 112 -2064 -272 -2064
WIRE -1056 -2048 -1056 -2080
WIRE 2544 -2048 2544 -2128
WIRE -272 -2032 -272 -2064
WIRE -672 -1968 -1056 -1968
WIRE 112 -1952 -272 -1952
WIRE 2048 -1952 2048 -2016
WIRE -1056 -1888 -1056 -1968
WIRE -672 -1888 -672 -1968
WIRE 2544 -1888 2544 -1968
WIRE 4336 -1888 4304 -1888
WIRE 4448 -1888 4400 -1888
WIRE 6080 -1888 6032 -1888
WIRE 6176 -1888 6144 -1888
WIRE -672 -1872 -672 -1888
WIRE -272 -1872 -272 -1952
WIRE 112 -1872 112 -1952
WIRE 112 -1856 112 -1872
WIRE 4512 -1856 4512 -2048
WIRE 4624 -1856 4512 -1856
WIRE 5968 -1856 5968 -2048
WIRE 5968 -1856 5856 -1856
WIRE 4512 -1824 4512 -1856
WIRE 5968 -1824 5968 -1856
WIRE 2048 -1808 2048 -1872
WIRE 4240 -1808 4192 -1808
WIRE 4304 -1808 4304 -1888
WIRE 4304 -1808 4240 -1808
WIRE 4320 -1808 4304 -1808
WIRE 4336 -1808 4320 -1808
WIRE 4432 -1808 4416 -1808
WIRE 4448 -1808 4448 -1888
WIRE 4448 -1808 4432 -1808
WIRE 4464 -1808 4448 -1808
WIRE 4624 -1808 4624 -1856
WIRE 5856 -1808 5856 -1856
WIRE 6032 -1808 6032 -1888
WIRE 6032 -1808 6016 -1808
WIRE 6048 -1808 6032 -1808
WIRE 6064 -1808 6048 -1808
WIRE 6160 -1808 6144 -1808
WIRE 6176 -1808 6176 -1888
WIRE 6176 -1808 6160 -1808
WIRE 6240 -1808 6176 -1808
WIRE 6288 -1808 6240 -1808
WIRE 4080 -1776 4080 -2144
WIRE 4432 -1776 4432 -1808
WIRE 4432 -1776 4352 -1776
WIRE 6048 -1776 6048 -1808
WIRE 6128 -1776 6048 -1776
WIRE 6400 -1776 6400 -2144
WIRE 2544 -1760 2544 -1808
WIRE 4320 -1760 4320 -1808
WIRE 4320 -1760 4272 -1760
WIRE 4464 -1760 4432 -1760
WIRE 6048 -1760 6016 -1760
WIRE 6160 -1760 6160 -1808
WIRE 6208 -1760 6160 -1760
WIRE -1056 -1728 -1056 -1808
WIRE -672 -1728 -672 -1808
WIRE -672 -1728 -1056 -1728
WIRE 4272 -1728 4272 -1760
WIRE 4352 -1728 4352 -1776
WIRE 4432 -1728 4432 -1760
WIRE 6048 -1728 6048 -1760
WIRE 6128 -1728 6128 -1776
WIRE 6208 -1728 6208 -1760
WIRE -272 -1712 -272 -1792
WIRE 112 -1712 112 -1792
WIRE 112 -1712 -272 -1712
WIRE -1056 -1696 -1056 -1728
WIRE 4512 -1696 4512 -1744
WIRE 4624 -1696 4624 -1744
WIRE 4624 -1696 4512 -1696
WIRE 5856 -1696 5856 -1744
WIRE 5968 -1696 5968 -1744
WIRE 5968 -1696 5856 -1696
WIRE -272 -1680 -272 -1712
WIRE 4272 -1632 4272 -1648
WIRE 4352 -1632 4352 -1664
WIRE 4352 -1632 4272 -1632
WIRE 6128 -1632 6128 -1664
WIRE 6208 -1632 6208 -1648
WIRE 6208 -1632 6128 -1632
WIRE 4352 -1616 4352 -1632
WIRE 4512 -1616 4512 -1696
WIRE 4688 -1616 4512 -1616
WIRE 4800 -1616 4688 -1616
WIRE 5024 -1616 4880 -1616
WIRE 5136 -1616 5024 -1616
WIRE 5968 -1616 5968 -1696
WIRE 5968 -1616 5344 -1616
WIRE 6128 -1616 6128 -1632
WIRE 2048 -1552 2048 -1728
WIRE 2048 -1552 1952 -1552
WIRE 2544 -1552 2544 -1616
WIRE 2544 -1552 2048 -1552
WIRE 2784 -1552 2544 -1552
WIRE 4080 -1552 4080 -1632
WIRE 4080 -1552 3936 -1552
WIRE 4512 -1552 4512 -1616
WIRE 5968 -1552 5968 -1616
WIRE 1952 -1536 1952 -1552
WIRE 2784 -1536 2784 -1552
WIRE 3936 -1536 3936 -1552
WIRE 4336 -1488 4304 -1488
WIRE 4448 -1488 4400 -1488
WIRE 6080 -1488 6032 -1488
WIRE 6176 -1488 6144 -1488
WIRE 5136 -1472 5136 -1616
WIRE 5344 -1472 5344 -1616
WIRE 2048 -1456 2048 -1552
WIRE 4080 -1456 4080 -1552
WIRE 4512 -1456 4512 -1472
WIRE 4624 -1456 4512 -1456
WIRE 5968 -1456 5968 -1472
WIRE 5968 -1456 5856 -1456
WIRE 6400 -1456 6400 -1632
WIRE 2544 -1440 2544 -1552
WIRE 4512 -1424 4512 -1456
WIRE 5968 -1424 5968 -1456
WIRE 4240 -1408 4192 -1408
WIRE 4304 -1408 4304 -1488
WIRE 4304 -1408 4240 -1408
WIRE 4320 -1408 4304 -1408
WIRE 4336 -1408 4320 -1408
WIRE 4432 -1408 4416 -1408
WIRE 4448 -1408 4448 -1488
WIRE 4448 -1408 4432 -1408
WIRE 4464 -1408 4448 -1408
WIRE 4624 -1408 4624 -1456
WIRE 5856 -1408 5856 -1456
WIRE 6032 -1408 6032 -1488
WIRE 6032 -1408 6016 -1408
WIRE 6048 -1408 6032 -1408
WIRE 6064 -1408 6048 -1408
WIRE 6160 -1408 6144 -1408
WIRE 6176 -1408 6176 -1488
WIRE 6176 -1408 6160 -1408
WIRE 6240 -1408 6176 -1408
WIRE 6288 -1408 6240 -1408
WIRE 4432 -1376 4432 -1408
WIRE 4432 -1376 4352 -1376
WIRE 6048 -1376 6048 -1408
WIRE 6128 -1376 6048 -1376
WIRE 2768 -1360 2768 -1760
WIRE 4320 -1360 4320 -1408
WIRE 4320 -1360 4272 -1360
WIRE 4464 -1360 4432 -1360
WIRE 6048 -1360 6016 -1360
WIRE 6160 -1360 6160 -1408
WIRE 6208 -1360 6160 -1360
WIRE 2768 -1344 2768 -1360
WIRE 4272 -1328 4272 -1360
WIRE 4352 -1328 4352 -1376
WIRE 4432 -1328 4432 -1360
WIRE 6048 -1328 6048 -1360
WIRE 6128 -1328 6128 -1376
WIRE 6208 -1328 6208 -1360
WIRE 2048 -1312 2048 -1376
WIRE 5136 -1312 5136 -1392
WIRE 5344 -1312 5344 -1392
WIRE 4512 -1296 4512 -1344
WIRE 4624 -1296 4624 -1344
WIRE 4624 -1296 4512 -1296
WIRE 5856 -1296 5856 -1344
WIRE 5968 -1296 5968 -1344
WIRE 5968 -1296 5856 -1296
WIRE 2544 -1264 2544 -1296
WIRE 4272 -1232 4272 -1248
WIRE 4352 -1232 4352 -1264
WIRE 4352 -1232 4272 -1232
WIRE 6128 -1232 6128 -1264
WIRE 6208 -1232 6208 -1248
WIRE 6208 -1232 6128 -1232
WIRE 4352 -1216 4352 -1232
WIRE 6128 -1216 6128 -1232
WIRE 2048 -1168 2048 -1232
WIRE 2544 -1104 2544 -1184
WIRE 5136 -1104 5136 -1232
WIRE 5344 -1104 5344 -1232
WIRE 5344 -1104 5136 -1104
WIRE 4080 -960 4080 -1312
WIRE 4080 -960 4048 -960
WIRE 4128 -960 4080 -960
WIRE 4512 -960 4512 -1296
WIRE 4512 -960 4128 -960
WIRE 5968 -960 5968 -1296
WIRE 6288 -960 5968 -960
WIRE 6400 -960 6400 -1312
WIRE 6400 -960 6288 -960
WIRE 6432 -960 6400 -960
WIRE 2048 -944 2048 -1088
WIRE 2176 -944 2048 -944
WIRE 2304 -944 2256 -944
WIRE 2544 -944 2544 -1024
WIRE 2544 -944 2384 -944
WIRE 2768 -944 2768 -1216
WIRE 2768 -944 2544 -944
WIRE 2944 -944 2768 -944
FLAG -4816 -2160 0
FLAG -4432 -2480 tri_ref
FLAG -6224 -2128 0
FLAG -5824 -2448 sin_ref
FLAG -5440 -2144 0
FLAG -5040 -2464 dc_ref
FLAG -3152 -2864 sw_drive
FLAG -3536 -2592 0
FLAG -4176 -4064 isns_drive_active+
FLAG -5216 -3776 0
FLAG -5344 -3952 isns_plus
FLAG -5344 -3872 isns_minus
FLAG -6032 -3568 0
FLAG -5632 -3888 isns_sin_ref
FLAG 112 -2304 phB_hs_drive
FLAG -272 -2032 0
FLAG 112 -1952 phB_ls_drive
FLAG -272 -1680 0
FLAG -672 -2320 phA_hs_drive
FLAG -1056 -2048 0
FLAG -672 -1968 phA_ls_drive
FLAG -1056 -1696 0
FLAG 1952 -1536 0
FLAG 4432 -1728 0
FLAG 4352 -1616 0
FLAG 4240 -1808 phA_hs_drive
FLAG 4432 -1328 0
FLAG 4352 -1216 0
FLAG 4240 -1408 phA_ls_drive
FLAG 6048 -1728 0
FLAG 6128 -1616 0
FLAG 6240 -1808 phB_hs_drive
FLAG 6048 -1328 0
FLAG 6128 -1216 0
FLAG 6240 -1408 phB_ls_drive
FLAG 4160 -2144 +VPWR
FLAG 4128 -960 -VPWR
FLAG 3936 -1536 0
FLAG 3056 -2128 +VPWR
FLAG 3104 -944 -VPWR
FLAG 6304 -2144 +VPWR
FLAG 6288 -960 -VPWR
FLAG 4688 -1616 isns_plus
FLAG 5024 -1616 isns_minus
FLAG -3024 -4096 0
FLAG -2576 -3776 0
FLAG -2432 -3856 isns_drive+
FLAG -2256 -4048 isns_drive_active+
FLAG -3152 -3920 0
FLAG -2496 -3936 0
FLAG -6080 -3344 isns_plus
FLAG -6080 -3264 isns_minus
FLAG -5616 -3344 isns_plus_filt
FLAG -5552 -3264 isns_minus_filt
FLAG -5216 -3264 0
FLAG -5344 -3440 isns_plus
FLAG -5344 -3360 isns_minus
FLAG -3088 -3584 0
FLAG -2640 -3264 0
FLAG -2496 -3344 isns_drive-
FLAG -2320 -3536 isns_drive_active-
FLAG -3216 -3408 0
FLAG -2560 -3424 0
FLAG -4176 -3984 0
FLAG -4400 -3968 0
FLAG -4320 -4176 0
FLAG -4544 -4096 0
FLAG -4496 -4160 samp
FLAG -4176 -3552 isns_drive_active-
FLAG -4176 -3472 0
FLAG -4400 -3456 0
FLAG -4320 -3664 0
FLAG -4544 -3584 0
FLAG -4496 -3648 samp
FLAG -4320 -3440 0
FLAG -4320 -3952 0
FLAG -4736 -4048 isns+_samp_hold
FLAG -4064 -3072 0
FLAG -4064 -3152 samp
SYMBOL voltage -4816 -2400 R0
WINDOW 3 54 232 Left 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR Value PULSE(-10 10 0 .025m .025m 0 .05m 20000)
SYMATTR InstName V1
SYMBOL res -4432 -2400 R0
SYMATTR InstName R1
SYMATTR Value 1
SYMBOL res -5840 -2368 R0
SYMATTR InstName R2
SYMATTR Value 1
SYMBOL voltage -6224 -2368 R0
WINDOW 3 44 230 Left 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR Value SINE(0 5 400 0 0 0 2000)
SYMATTR InstName V2
SYMBOL res -5056 -2384 R0
SYMATTR InstName R3
SYMATTR Value 1
SYMBOL voltage -5440 -2384 R0
WINDOW 3 -37 100 Left 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR Value -6
SYMATTR InstName V3
SYMBOL res -3168 -2800 R0
SYMATTR InstName R4
SYMATTR Value 1k
SYMBOL bv -3536 -2800 R0
WINDOW 3 -591 263 Left 2
SYMATTR InstName B1
SYMATTR Value V=if(V(sin_ref)>0,if(V(sin_ref)>V(tri_ref),if(V(isns_drive+)>8,10,0),0),if(V(isns_drive-)>8,10,if(V(sin_ref)>V(tri_ref),10,0)))
SYMBOL res -4848 -3984 R0
SYMATTR InstName R5
SYMATTR Value 1k
SYMBOL bv -5216 -3984 R0
WINDOW 3 -253 272 Left 2
SYMATTR InstName B2
SYMATTR Value V=if(V(isns_plus,isns_minus)>V(isns_sin_ref),if(V(isns_plus,isns_minus)>-0.5,0,10),10)
SYMBOL res -5360 -3968 R0
SYMATTR InstName R6
SYMATTR Value 10k
SYMBOL res -5056 -4064 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R7
SYMATTR Value 100
SYMBOL cap -5024 -3968 R0
SYMATTR InstName C1
SYMATTR Value 0.1µ
SYMBOL res -5648 -3808 R0
SYMATTR InstName R8
SYMATTR Value 10k
SYMBOL voltage -6032 -3808 R0
WINDOW 3 -276 105 Left 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR Value SINE(0 1 400 0 0 0 2000)
SYMATTR InstName V4
SYMBOL res 96 -2240 R0
SYMATTR InstName R9
SYMATTR Value 1k
SYMBOL bv -272 -2240 R0
SYMATTR InstName B3
SYMATTR Value V=if(V(sw_drive)<5,10,0)
SYMBOL res 96 -1888 R0
SYMATTR InstName R10
SYMATTR Value 1k
SYMBOL bv -272 -1888 R0
SYMATTR InstName B4
SYMATTR Value V=if(V(sw_drive)>5,10,0)
SYMBOL res -688 -2256 R0
SYMATTR InstName R11
SYMATTR Value 1k
SYMBOL bv -1056 -2256 R0
SYMATTR InstName B5
SYMATTR Value V=if(V(sw_drive)>5,10,0)
SYMBOL res -688 -1904 R0
SYMATTR InstName R12
SYMATTR Value 1k
SYMBOL bv -1056 -1904 R0
SYMATTR InstName B6
SYMATTR Value V=if(V(sw_drive)<5,10,0)
SYMBOL sw 4512 -1328 M180
SYMATTR InstName S1
SYMBOL sw 4512 -1728 M180
SYMATTR InstName S2
SYMBOL voltage 2048 -1824 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V5
SYMATTR Value 135
SYMBOL diode 4640 -1744 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D1
SYMBOL diode 4640 -1344 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D2
SYMBOL res 4496 -2144 R0
SYMATTR InstName R13
SYMATTR Value 15m
SYMBOL res 4496 -1568 R0
SYMATTR InstName R14
SYMATTR Value 15m
SYMBOL voltage 2048 -1472 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V6
SYMATTR Value 135
SYMBOL res 5120 -1328 R0
SYMATTR InstName R15
SYMATTR Value .07
SYMBOL cap 4064 -1696 R0
SYMATTR InstName C2
SYMATTR Value 100µ
SYMBOL cap 4064 -1456 R0
SYMATTR InstName C3
SYMATTR Value 100µ
SYMBOL res 4064 -1792 R0
SYMATTR InstName FILM_ESR1
SYMATTR Value .001
SYMBOL res 4064 -1408 R0
SYMATTR InstName R16
SYMATTR Value .001
SYMBOL ind 5120 -1488 R0
SYMATTR InstName Load1
SYMATTR Value 70µ
SYMBOL cap 2528 -1680 R0
WINDOW 3 24 54 Left 2
SYMATTR Value 10000µ
SYMATTR InstName C4
SYMBOL res 2528 -1776 R0
SYMATTR InstName ALE_ESR1
SYMATTR Value .0125
SYMBOL cap 2528 -1440 R0
SYMATTR InstName C5
SYMATTR Value 10000µ
SYMBOL res 2528 -1392 R0
SYMATTR InstName R17
SYMATTR Value .0125
SYMBOL ind 2528 -1904 R0
SYMATTR InstName L1
SYMATTR Value 500n
SYMBOL ind 2528 -1280 R0
SYMATTR InstName L2
SYMATTR Value 500n
SYMBOL ind 2032 -2112 R0
SYMATTR InstName L3
SYMATTR Value 900n
SYMBOL res 2032 -1968 R0
SYMATTR InstName R18
SYMATTR Value 25.4m
SYMBOL res 2032 -1328 R0
SYMATTR InstName R19
SYMATTR Value 25.4m
SYMBOL ind 2032 -1184 R0
SYMATTR InstName L4
SYMATTR Value 900n
SYMBOL res 2288 -2144 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R20
SYMATTR Value .005
SYMBOL res 2272 -960 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R21
SYMATTR Value .005
SYMBOL ind 2288 -928 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L5
SYMATTR Value 20n
SYMBOL ind 2288 -2112 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L6
SYMATTR Value 20n
SYMBOL res 4432 -1824 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R22
SYMATTR Value 10
SYMBOL cap 4336 -1728 R0
SYMATTR InstName C6
SYMATTR Value 10n
SYMBOL res 4256 -1744 R0
SYMATTR InstName R23
SYMATTR Value 10
SYMBOL diode 4400 -1904 R90
WINDOW 3 32 32 VTop 2
WINDOW 0 0 32 VBottom 2
SYMATTR Value MUR460
SYMATTR InstName D3
SYMBOL res 4432 -1424 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R24
SYMATTR Value 10
SYMBOL cap 4336 -1328 R0
SYMATTR InstName C7
SYMATTR Value 10n
SYMBOL res 4256 -1344 R0
SYMATTR InstName R25
SYMATTR Value 10
SYMBOL diode 4400 -1504 R90
WINDOW 3 32 32 VTop 2
WINDOW 0 0 32 VBottom 2
SYMATTR Value MUR460
SYMATTR InstName D4
SYMBOL res 3072 -2144 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 40 46 VTop 2
SYMATTR InstName HBRDG_IN1
SYMATTR Value 1.1m
SYMBOL res 3120 -960 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R26
SYMATTR Value 1.1m
SYMBOL res 2528 -2064 R0
SYMATTR InstName R27
SYMATTR Value .0006
SYMBOL res 2528 -1120 R0
SYMATTR InstName R28
SYMATTR Value .0006
SYMBOL ind 3040 -960 R90
WINDOW 0 5 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName L7
SYMATTR Value 120n
SYMBOL ind 2880 -2112 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L8
SYMATTR Value 120n
SYMBOL sw 5968 -1328 R180
SYMATTR InstName S3
SYMBOL sw 5968 -1728 R180
SYMATTR InstName S4
SYMBOL diode 5840 -1744 M180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D5
SYMBOL diode 5840 -1344 M180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D6
SYMBOL res 5984 -2144 M0
SYMATTR InstName R29
SYMATTR Value 15m
SYMBOL res 5984 -1568 M0
SYMATTR InstName R30
SYMATTR Value 15m
SYMBOL res 5360 -1328 M0
SYMATTR InstName R31
SYMATTR Value .07
SYMBOL cap 6416 -1696 M0
SYMATTR InstName C8
SYMATTR Value 100µ
SYMBOL cap 6416 -1456 M0
SYMATTR InstName C9
SYMATTR Value 100µ
SYMBOL res 6416 -1792 M0
SYMATTR InstName FILM_ESR2
SYMATTR Value .001
SYMBOL res 6416 -1408 M0
SYMATTR InstName R32
SYMATTR Value .001
SYMBOL ind 5360 -1488 M0
SYMATTR InstName Load2
SYMATTR Value 70µ
SYMBOL res 6048 -1824 M90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R33
SYMATTR Value 10
SYMBOL cap 6144 -1728 M0
SYMATTR InstName C10
SYMATTR Value 10n
SYMBOL res 6224 -1744 M0
SYMATTR InstName R34
SYMATTR Value 10
SYMBOL diode 6080 -1904 M90
WINDOW 3 32 32 VTop 2
WINDOW 0 0 32 VBottom 2
SYMATTR Value MUR460
SYMATTR InstName D7
SYMBOL res 6048 -1424 M90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R35
SYMATTR Value 10
SYMBOL cap 6144 -1328 M0
SYMATTR InstName C11
SYMATTR Value 10n
SYMBOL res 6224 -1344 M0
SYMATTR InstName R36
SYMATTR Value 10
SYMBOL diode 6080 -1504 M90
WINDOW 3 32 32 VTop 2
WINDOW 0 0 32 VBottom 2
SYMATTR Value MUR460
SYMATTR InstName D8
SYMBOL res 4896 -1632 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R37
SYMATTR Value .005
SYMBOL voltage -3024 -4192 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V7
SYMATTR Value 10
SYMBOL sw -2880 -3952 M180
SYMATTR InstName S5
SYMBOL sw -2256 -3952 M180
SYMATTR InstName S6
SYMBOL res -2592 -3872 R0
SYMATTR InstName R38
SYMATTR Value 100k
SYMBOL voltage -2496 -4064 R0
WINDOW 3 -126 -47 Left 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V8
SYMATTR Value PULSE(0 10 .008 1n 1n 1 1 1)
SYMBOL voltage -3152 -4048 R0
WINDOW 3 -102 164 Left 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V9
SYMATTR Value PULSE(10 0 .008 1n 1n 1 1 1)
SYMBOL res -6096 -3360 R0
SYMATTR InstName R39
SYMATTR Value 10k
SYMBOL res -5824 -3360 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R40
SYMATTR Value 100
SYMBOL res -5536 -3248 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R41
SYMATTR Value 10k
SYMBOL cap -5776 -3328 R0
SYMATTR InstName C12
SYMATTR Value 4µ
SYMBOL res -4848 -3472 R0
SYMATTR InstName R45
SYMATTR Value 1k
SYMBOL bv -5216 -3472 R0
WINDOW 3 -1 270 Left 2
SYMATTR InstName B7
SYMATTR Value V=if(V(isns_plus,isns_minus)<V(isns_sin_ref),if(V(isns_plus,isns_minus)<0.5,10,0),0)
SYMBOL res -5360 -3456 R0
SYMATTR InstName R46
SYMATTR Value 10k
SYMBOL res -5056 -3552 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R47
SYMATTR Value 100
SYMBOL cap -5024 -3456 R0
SYMATTR InstName C13
SYMATTR Value .1µ
SYMBOL sw -2944 -3440 M180
SYMATTR InstName S7
SYMBOL sw -2320 -3440 M180
SYMATTR InstName S8
SYMBOL res -2656 -3360 R0
SYMATTR InstName R48
SYMATTR Value 100k
SYMBOL voltage -2560 -3552 R0
WINDOW 3 -126 -47 Left 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V11
SYMATTR Value PULSE(0 10 .008 1n 1n 1 1 1)
SYMBOL voltage -3216 -3536 R0
WINDOW 3 -102 164 Left 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V12
SYMATTR Value PULSE(10 0 .008 1n 1n 1 1 1)
SYMBOL cap -4416 -4032 R0
SYMATTR InstName C14
SYMATTR Value 0.01µ
SYMBOL res -4192 -4080 R0
SYMATTR InstName R42
SYMATTR Value 10k
SYMBOL sw -4528 -4048 M90
SYMATTR InstName S9
SYMATTR Value SW2
SYMBOL Opamps\\UniversalOpamp2 -4320 -4064 R0
SYMATTR InstName U1
SYMBOL voltage -4320 -4080 R180
WINDOW 0 24 96 Left 2
WINDOW 3 24 16 Left 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V13
SYMATTR Value 10
SYMBOL cap -4416 -3520 R0
SYMATTR InstName C15
SYMATTR Value 0.01µ
SYMBOL res -4192 -3568 R0
SYMATTR InstName R43
SYMATTR Value 10k
SYMBOL sw -4528 -3536 M90
SYMATTR InstName S10
SYMATTR Value SW2
SYMBOL Opamps\\UniversalOpamp2 -4320 -3552 R0
SYMATTR InstName U2
SYMBOL voltage -4320 -3568 R180
WINDOW 0 24 96 Left 2
WINDOW 3 24 16 Left 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V10
SYMATTR Value 10
SYMBOL voltage -4320 -3424 R180
WINDOW 0 24 96 Left 2
WINDOW 3 24 16 Left 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V14
SYMATTR Value 10
SYMBOL voltage -4320 -3936 R180
WINDOW 0 24 96 Left 2
WINDOW 3 24 16 Left 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V15
SYMATTR Value 10
SYMBOL voltage -4064 -3168 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V16
SYMATTR Value PULSE(0 10 0 1n 1n .1u 5u 10000)
SYMBOL cap 2752 -1824 R0
SYMATTR InstName C16
SYMATTR Value 100µ
SYMBOL res 2752 -1920 R0
SYMATTR InstName FILM_ESR3
SYMATTR Value .001
SYMBOL cap 2752 -1280 R0
SYMATTR InstName C17
SYMATTR Value 100µ
SYMBOL res 2752 -1376 R0
SYMATTR InstName FILM_ESR4
SYMATTR Value .001
TEXT -4800 -2616 Left 2 ;tri_ref is triangle wave generator\n8kHz is 0.125m\n10kHz is 0.1m\n20kHz is 0.05m
TEXT -6216 -2544 Left 2 ;sin_ref is the sine wave reference, used to compare to the triangle ref\nset to 400Hz\n2000 cycles is 5 seconds
TEXT -6224 -1992 Left 2 ;sin_ref is the sine wave reference\nfor 25%/75% duty cycle, set ref peak to: 5V\nfor 10%/90% duty cycle, set ref peak to: 8V\nfor 5%/95% duty cycle, set ref peak to: 9V\nfor 0%/100% duty cycle, set ref peak to: 10V
TEXT -4176 -4704 Left 2 ;Alternate PWM generator
TEXT -5848 -1584 Left 2 ;One control method that might work is to reduce the peak value of the sin ref\nin order to maintain 200A peak current on the output at different frequencies.
TEXT -4568 -4536 Left 2 ;Current sense disable:\nThis section will shut off the switch\nif the peak current hits the reference.\nThe current sense resistor is set such that a peak current\nof 200A will give 1V on the sense resistor, to match the 1V\non the reference the isns is compared to to shut off the switch
TEXT -6272 -4064 Left 2 ;This is the current sense reference for the +200A\nit is a +/-1V reference that sets the peak value\nfor the sensed current before the switch is shut off.\nThis reference will come from the resolver and should\nmatch the frequency that the motor is spinning
TEXT -5208 -4464 Left 2 ;Peak current detect shutdown
TEXT -3584 -3000 Left 2 ;This is the switch drive:\nThis will output a high if both the triangle voltage comparator\nand the current sense disable are high, otherwise it is low\ncurrent sense disable is active low
TEXT -4648 -2808 Left 2 ;The current sense disable circuit will go low to signal disable of switch
TEXT -5424 -2544 Left 2 ;DC ref is used to compare a DC value\nto the triangle ref
TEXT -5512 -2704 Left 2 ;Triangle reference comparitor
TEXT -424 -2336 Left 2 ;high side Phase B control
TEXT -424 -1984 Left 2 ;low side Phase B control
TEXT -1208 -2352 Left 2 ;high side Phase A control
TEXT -1208 -2000 Left 2 ;low side Phase A control
TEXT 1304 -2672 Left 2 !.tran 0 40m 20m
TEXT 1304 -2608 Left 2 !.model SW SW(Ron=0.002 Roff=1Meg Vt=3.0)
TEXT 1304 -2552 Left 2 !.ic I(Load1)=0.1 V(isns_drive)=0
TEXT 2224 -2216 Left 2 ;Cable
TEXT 2376 -1848 Left 2 ;Alum Cap
TEXT 2376 -1416 Left 2 ;Alum Cap
TEXT 4096 -1600 Left 2 ;Film Cap\nmax Iripple: 12.5A rms
TEXT 4160 -1360 Left 2 ;Film Cap
TEXT 2232 -1808 Left 2 ;4x2500uF cap, 50mOHM, \n10A max ripple I
TEXT 2304 -2008 Left 2 ;1x25A Fuse per cap\nESR: 2.35mOHMs
TEXT 2416 -1072 Left 2 ;Fuses
TEXT 2864 -2248 Left 2 ;Fuses: 2//25A fuses\nESR: 2.35mOHMs ea
TEXT 2976 -864 Left 2 ;Fuses
TEXT 6384 -1600 Right 2 ;Film Cap\nmax Iripple: 12.5A rms
TEXT 6320 -1360 Right 2 ;Film Cap
TEXT 2456 -2432 Left 2 ;Input Power Supply
TEXT 7800 -816 Left 2 ;page right
TEXT 4792 -1688 Left 2 ;Phase A Output
TEXT 5456 -1688 Left 2 ;Phase B Output
TEXT 5152 -2384 Left 2 ;Stator Drive
TEXT -568 -2480 Left 2 ;Switch Drives
TEXT -784 -1560 Left 2 ;Want PhA_high_side and PhB_low_side on at same time, and\nthey are inverse of PhA_low_side/PhB_high_side\n \nSin_ref will represent PhA ref. Want PhA_high_side driving high duty cycle\nwhen Sin_ref is high, and low duty cycle when sin_ref is low.
TEXT -200 1936 Left 2 ;page bottom
TEXT -7232 -1544 Left 2 ;page left
TEXT 1216 -4656 Left 2 ;page top
TEXT -6016 -2968 Left 2 ;basic current limit to +200A:\nV=if(V(isns_plus,isns_minus)>V(isns_sin_ref),if(V(isns_plus,isns_minus)>-0.5,0,10),10)
TEXT -3000 -4240 Left 2 ;Time delay to allow sim to come up to normal operation\nThis enables the current detect shutdown after some time
TEXT -5328 -4192 Left 2 ;This part keeps the current limit to +200A on the high side\nThis goes low to shut off the PWM and bring the current down\nThe disable pwm is active low
TEXT -6040 -3056 Left 2 ;V=if(V(isns_plus,isns_minus)>V(isns_sin_ref),if(V(isns_plus,isns_minus)>-0.5,0,if(V(isns_plus,isns_minus)<V(isns_sin_ref),if(V(isns_plus,isns_minus)<0.5,0,10),10)
TEXT -6040 -3088 Left 2 ;V=if(V(isns_plus,isns_minus)>V(isns_sin_ref),if(V(isns_plus,isns_minus)>-0.5,0,if(V(isns_plus,isns_minus)<V(isns_sin_ref),if(V(isns_plus,isns_minus)<0.5,0,10),10)),10)
TEXT -6016 -2896 Left 2 ;basic current limit to -200A:\nV=if(V(isns_plus,isns_minus)<V(isns_sin_ref),if(V(isns_plus,isns_minus)<0.5,10,0),0)
TEXT -5920 -3440 Left 2 ;fc=400Hz
TEXT -3592 -2432 Left 2 ;including active current limit:\nThis successfully limits it on the top side\nV=if(V(sin_ref)>V(tri_ref),if(V(isns_drive+)>5,10,0),0)
TEXT -3976 -2472 Left 2 ;disabling active current limit:\nV=if(V(sin_ref)>V(tri_ref),10,0)
TEXT -3592 -2296 Left 2 ;including active current limit:\nThis successfully limits it on the bottom side\nV=if(V(isns_drive-)>8,10,if(V(sin_ref)>V(tri_ref),10,0))
TEXT -5304 -3656 Left 2 ;This part keeps the current limit to -200A on the low side\nThis to go high when we need to turn on the PWM higher\nThis enable PWM is active high
TEXT -3064 -3728 Left 2 ;Time delay to allow sim to come up to normal operation\nThis enables the current detect shutdown after some time
TEXT -3592 -2168 Left 2 ;including active current limit:\nThis successfully limits it on the bottom side and top side\nV=if(V(sin_ref)>0,if(V(sin_ref)>V(tri_ref),if(V(isns_drive+)>5,10,0),0),if(V(isns_drive-)>8,10,if(V(sin_ref)>V(tri_ref),10,0)))
TEXT -4272 -4304 Left 2 !.model SW2 SW(Ron=0.002 Roff=1Meg Vt=9.5)
TEXT -4096 -3016 Left 2 ;sample and hold clock\nsamples 10x per duty cycle\nfsw=20k, fsamp=200k
TEXT -7136 -2992 Left 2 ;When changing frequency, make sure to change both\nsin_ref and isns_sin_ref
RECTANGLE Normal -4256 -1760 -6352 -2672 2
RECTANGLE Normal 3168 -672 1904 -2400 2
RECTANGLE Normal 6592 -800 3808 -2320 2
RECTANGLE Normal 352 -1600 -1280 -2448 2
RECTANGLE Normal -3760 -2784 -6400 -4384 2
RECTANGLE Normal -2128 -3184 -3360 -4352 2
RECTANGLE Normal -2000 -1392 -6528 -4608 2
